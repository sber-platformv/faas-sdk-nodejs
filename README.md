# FAAS-SDK –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ Node.js —Ñ—É–Ω–∫—Ü–∏–π

FAAS-SDK –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ [Platform V Functions](https://developers.sber.ru/portal/products/platform-v-functions) –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–∏—Å–∞—Ç—å HTTP —Å–µ—Ä–≤–µ—Ä –∏ –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.

SDK –¥–ª—è Node.js —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–∞–∫–µ—Ç.

## –ü—Ä–µ—Ä–µ–∫–≤–∏–∑–∏—Ç—ã

* NodeJS 16.x;
* npm;

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç NodeJS —Å —Ñ–∞–π–ª–æ–º `package.json`. –ù–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `npm init -y` –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –≤ –∫–æ—Ç–æ—Ä–æ–π –Ω—É–∂–Ω–æ —Ä–∞—Å–ø–æ–ª–æ–∂–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä `test-function`.

2. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é Functions, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è. –ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –≥–æ—Ç–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî –≤—ã –º–æ–∂–µ—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å –ø—Ä–∏–º–µ—Ä–æ–º –∏–∑ Functions, –ª–∏–±–æ —Å–æ–∑–¥–∞—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª `function/handlers/handler.js` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π:
   
	```js
    	exports.handler = (req, res) => {
  	    	console.log(`Request received: ${JSON.stringify(req.body)}\nMethod: ${req.method}`);
    		res.status(200).send(`Hello from NodeJS function!\nYou said: ${JSON.stringify(req.body)}`);
		};
	```
    
    >–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é Functions. 

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SDK –∫–æ–º–∞–Ω–¥–æ–π CLI `npm install faas-sdk-nodejs`. –£—Å—Ç–∞–Ω–æ–≤–∫—É —Å–ª–µ–¥—É–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –≤ –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ ‚Äî `test-function`.

4. –î–æ–±–∞–≤—å—Ç–µ —Å–∫—Ä–∏–ø—Ç `start` –≤ —Ñ–∞–π–ª `package.json` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
    
    ```json
      "scripts": {
        "start": "faas-sdk-nodejs --source=./function/handlers/handler.js"
      }
    ```
   , –≥–¥–µ. `--source=./function/handlers/handler.js` ‚Äî –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤.
   
5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π `npm start`:
    
    ```sh
        npm start
        ...
        Function: handler
        üöÄ Function ready at http://localhost:8082
    ```
    
6. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É—è `curl`, –±—Ä–∞—É–∑–µ—Ä –∏–ª–∏ –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
    
    ```sh
        curl localhost:8082
        # Hello from NodeJS function!
        # You said:
    ```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ó–∞–ø—É—Å–∫ SDK –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Ñ–ª–∞–≥–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—ã:

| –§–ª–∞–≥        | –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ä–µ–¥—ã  | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ                                                                 |
| ------------| ------------------|-----------------------| -------------------------------------------------------------------------|
| `--port`    | `PORT`            | 8082                  | –ü–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª—É—à–∞—Ç–µ–ª—å –∑–∞–ø—Ä–æ—Å–æ–≤ faas-sdk-nodejs       |
| `--target`  | `FUNCTION_TARGET` | handler               | –ò–º—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö        |
| `--source`  | `FUNCTION_SOURCE` | handlers/handler.js   | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Ñ—É–Ω–∫—Ü–∏–∏                                                     |

–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–ª–∞–≥–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å–∫—Ä–∏–ø—Ç `start` —Ñ–∞–π–ª–∞ `package.json` –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```json
  "scripts": {
    "start": "faas-sdk-nodejs --target=your_function_name --source=./function/handlers/handler.js"
  }
```

–ï—Å–ª–∏ —Ñ–ª–∞–≥–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã, –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—É—Å–∫–∞ SDK –±—É–¥—É—Ç –ø–æ–¥—Ç—è–Ω—É—Ç—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—ã Node.js.

## Unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –≤ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—É—é –ª–æ–∫–∞–ª—å–Ω–æ —Ñ—É–Ω–∫—Ü–∏—é —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ –≤ –ª—é–±–æ–π NodeJS –ø—Ä–æ–µ–∫—Ç. –î–ª—è —ç—Ç–æ–≥–æ –¥–æ–±–∞–≤—å—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä `jest`, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –¥–æ–±–∞–≤–ª—è—Ç—å unit-—Ç–µ—Å—Ç—ã –Ω—É–∂–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç —Ñ—É–Ω–∫—Ü–∏–∏, –∞ –Ω–µ –≤ –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

–ù–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π unit-—Ç–µ—Å—Ç –≤ `hello, world` –ø—Ä–∏–º–µ—Ä –≤ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏:

1. –í `package.json` –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏:
    
    ```json
     ...
      "scripts": {
          "test": "jest",
          "prepare-function": "npm run test"
      },
      "devDependencies": {
          "jest": "^27.5.1",
          "sinon": "^13.0.2"
      }
    ...
    ```
    
2. –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞ –≤–µ–¥–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ, —Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `jest` –∏ `sinon` –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–∞–º–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:
    
    ```shell
    npm install jest@27.5.1
    npm install sinon@13.0.2
    ```
    
3. –°–æ–∑–¥–∞–π—Ç–µ –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é **test** –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ –Ω–µ–µ —Ñ–∞–π–ª `handler.test.js` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º:
    
    ```json
    const sinon = require("sinon");
    const assert = require("assert");
    const {handler} = require("../handlers/handler");

    test("Function test", () => {
        // Mock ExpressJS 'req' and 'res' parameters
        const req = {
            body: "Hi from function!"
        };
        const res = {
            send: sinon.stub(),
            status: function (s) {
                this.statusCode = s;
                return this;
            }
        };

        // Call function
        handler(req, res);

        const expectedResponse = `Hello from NodeJS function!\nYou said: ${JSON.stringify(req.body)}`;

        assert.ok(res.send.calledOnce);
        assert.deepStrictEqual(res.send.firstCall.firstArg, expectedResponse);
    });
    ```
    
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–±–æ—Ä–∫—É —Ñ—É–Ω–∫—Ü–∏–∏. –õ–æ–≥–∏ unit-—Ç–µ—Å—Ç–∞ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.
